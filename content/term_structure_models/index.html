<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interest Rate Term Structure Models: An Educational Guide</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Crimson Text', Georgia, serif;
            line-height: 1.4;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            font-family: 'Lora', serif;
            color: #2c3e50;
        }
        h1 {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 1em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5em;
        }
        h2 {
            font-size: 1.8em;
            margin-top: 1.5em;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 0.3em;
        }
        h3 {
            font-size: 1.3em;
            margin-top: 1.2em;
        }
        .toc {
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .toc h2 {
            margin-top: 0;
            color: #3498db;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 20px;
        }
        .toc a {
            color: #2980b9;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .toc a:hover {
            color: #3498db;
        }
        .chapter {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .implementation-guide {
            background-color: #e8f8f5;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .hint {
            background-color: #fff5e6;
            border-left: 5px solid #f39c12;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .key-concept {
            background-color: #e8f4f8;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .quiz {
            background-color: #fdedec;
            border: 1px solid #e74c3c;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
        }
        p, li {
            font-size: 16px;
        }
        .references {
            border-top: 1px solid #e9ecef;
            padding-top: 20px;
            margin-top: 30px;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        pre[class*="language-"] {
            font-size: 12px;
            border-radius: 4px;
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
        }
        code[class*="language-"] {
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Interest Rate Term Structure Models: An Educational Guide</h1>
    
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#zero-coupon-bonds">Zero-Coupon Bond Prices and Yields</a></li>
            <li><a href="#vasicek-model">Vasicek Model</a></li>
            <li><a href="#cir-model">Cox-Ingersoll-Ross (CIR) Model</a></li>
            <li><a href="#hull-white-model">Hull-White Model</a></li>
            <li><a href="#g2-model">G2++ Model</a></li>
            <li><a href="#dynamic-affine-models">Dynamic Affine Term Structure Models</a></li>
        </ul>
    </div>

    <div id="introduction" class="chapter">
        <h2>Introduction</h2>
        <p>
            Welcome to my notes to a type of interest rate term structure models called the <b>short-rate model</b>. 
            It is disguised as a step-by-step guide and is written to help you (and me) understand, formulate, and solve 
            this type of models by deriving and implementing well-known models of varying complexity and generality.
        </p>
        <p>
            In a short-rate model, we focus on the modeling of the evolution of the instantaneous spot rate, also 
            known as the short rate, at which the market lends to a borrower for an infinitesimal period of time. 
            In a short-rate model, the short rate is assumed to evolve over time according to a stochastic process 
            that captures the observed or theorized behavior. As the short rate evolve into the future, by the 
            no-arbitrage principle, all rates at which the market lends to a borrower over longer periods of time can
            be determined by the parameters of the models. These parameters are unknown in practice, so much either be
            calibrated from the market observed yield curve or estimated from historical data.
        </p>
        <p>
            For each model, I first describe the process that drives the short rate. I then provide a step-by-step guide
            to derive the price of a zero-coupon bond, where some steps are left as exercise. It is then followed by a 
            guide to Python implementations of the pricing of the zero coupon bond, the simulation of the process, and an
            construction of a lattice that is sometimes used to price other derivatives.
        </p>
        <ul>
            <li>Theoretical background</li>
            <li>Key concepts</li>
            <li>Step-by-step Zero-Coupon Bond pricing guides</li>
            <li>Step-by-step Python implementation guides</li>
            <li>Hints and tips</li>
            <li>Quizzes to test your understanding</li>
        </ul>
        <p>
            Let's begin our journey into the world of interest rate modeling using short-rate models!
        </p>
    </div>

    <div id="zero-coupon-bonds" class="chapter">
        <h2>Zero-Coupon Bond Prices and Yields</h2>
        <p>
            Before diving into specific models, it's crucial to understand the basics of zero-coupon bonds and their relationship to interest rates and short rates.
        </p>
        
        <div class="key-concept">
            <h3>Key Concept: Zero-Coupon Bonds</h3>
            <p>
                A zero-coupon bond is a financial instrument that doesn't pay interest (coupons) but instead is sold at a discount to its face value. The bond's yield comes from the difference between the purchase price and the face value paid at maturity.
            </p>
        </div>

        <h3>Mathematical Formulation</h3>
        <p>
            Let \(P_t^T\) be the price at time \(t\) of a zero-coupon bond maturing at time \(T\). The corresponding yield \(y_t^T\) is defined by:
        </p>
        <p>
            \[P_t^T = e^{-y_t^T(T-t)}\]
        </p>
        <p>
            This relationship is fundamental to understanding term structure models.
        </p>

        <div class="implementation-guide">
            <h3>Implementation Guide: Calculating Bond Prices and Yields</h3>
            <ol>
                <li>Define variables:
                    <ul>
                        <li>\(P\): Bond price</li>
                        <li>\(y\): Yield to maturity</li>
                        <li>\(T\): Time to maturity</li>
                    </ul>
                </li>
                <li>To calculate the bond price given the yield:
                    <pre><code class="language-python">P = exp(-y * T)</code></pre>
                </li>
                <li>To calculate the yield given the bond price:
                    <pre><code class="language-python">y = -log(P) / T</code></pre>
                </li>
            </ol>
        </div>

        <div class="hint">
            <h4>Hint</h4>
            <p>
                Remember that yields and prices move in opposite directions. As yields increase, bond prices decrease, and vice versa.
            </p>
        </div>

        <div class="quiz">
            <h3>Quick Quiz</h3>
            <ol>
                <li>What is the price of a 5-year zero-coupon bond with a yield of 3%?</li>
                <li>If a 2-year zero-coupon bond is priced at 0.95, what is its yield?</li>
            </ol>
        </div>
    </div>

    <div id="vasicek-model" class="chapter">
        <h2>Vasicek Model</h2>
        <p>
            The Vasicek model, introduced by Oldrich Vasicek in 1977, is one of the earliest and most influential term structure models. It assumes that the short-term interest rate follows a mean-reverting Ornstein-Uhlenbeck process.
        </p>

        <div class="key-concept">
            <h3>Key Concept: Mean Reversion</h3>
            <p>
                Mean reversion is the tendency of a process to "pull back" towards its long-term average. In the context of interest rates, this reflects the economic intuition that rates tend to fluctuate around a long-term equilibrium level.
            </p>
        </div>

        <h3>Model Specification</h3>
        <p>
            The Vasicek model is defined by the following stochastic differential equation:
        </p>
        <p>
            \[dr_t = \kappa(\theta - r_t)dt + \sigma dW_t\]
        </p>
        <p>
            where:
        </p>
        <ul>
            <li>\(r_t\): short-term interest rate at time \(t\)</li>
            <li>\(\kappa\): speed of mean reversion</li>
            <li>\(\theta\): long-term mean level</li>
            <li>\(\sigma\): volatility</li>
            <li>\(W_t\): Wiener process (standard Brownian motion)</li>
        </ul>

        <div class="implementation-guide">
            <h3>Implementation Guide: Simulating the Vasicek Model</h3>
            <ol>
                <li>Import necessary libraries (numpy for numerical computations)</li>
                <li>Define model parameters: \(r_0\), \(\kappa\), \(\theta\), \(\sigma\)</li>
                <li>Set up time grid: \(t = [0, \Delta t, 2\Delta t, ..., T]\)</li>
                <li>Initialize array for interest rates: \(r = [r_0, 0, 0, ..., 0]\)</li>
                <li>Implement Euler-Maruyama method for simulation:
                    <pre><code class="language-python">
for i in range(1, len(t)):
    delta_r = kappa * (theta - r[i-1]) * delta_t + sigma * sqrt(delta_t) * random.normal()
    r[i] = r[i-1] + delta_r
                    </code></pre>
                </li>
            </ol>
        </div>

        <div class="hint">
            <h4>Hint</h4>
            <p>
                The Euler-Maruyama method is a simple way to approximate solutions to SDEs. For more accurate results, consider using the Milstein scheme or higher-order methods.
            </p>
        </div>

        <h3>Bond Pricing in the Vasicek Model</h3>
        <p>
            One of the advantages of the Vasicek model is that it allows for closed-form solutions for bond prices. The price of a zero-coupon bond is given by:
        </p>
        <p>
            \[P(t,T) = A(t,T)e^{-B(t,T)r_t}\]
        </p>
        <p>
            where \(A(t,T)\) and \(B(t,T)\) are functions of the model parameters.
        </p>

        <div class="key-concept">
            <h4>Derivation of A(t,T) and B(t,T)</h4>
            <ol>
                <li>
                    <p>We start with the assumption that the bond price has the form:</p>
                    \[P(t,T) = e^{C(t,T) - D(t,T)r_t}\]
                    <p>where we need to determine C(t,T) and D(t,T).</p>
                </li>
                <li>
                    <p>Apply Itô's lemma to this bond price formula:</p>
                    \[\frac{dP(t,T)}{P(t,T)} = \left(\frac{\partial C}{\partial t} - \frac{\partial D}{\partial t}r_t - D\kappa(\theta - r_t) + \frac{1}{2}D^2\sigma^2\right)dt - D\sigma dW_t\]
                </li>
                <li>
                    <p>Under the risk-neutral measure, the drift of the bond price should equal the short rate \(r_t\):</p>
                    \[r_t = \frac{\partial C}{\partial t} - \frac{\partial D}{\partial t}r_t - D\kappa(\theta - r_t) + \frac{1}{2}D^2\sigma^2\]
                </li>
                <li>
                    <p>Equating the coefficients of \(r_t\) and the constant terms:</p>
                    \[\frac{\partial D}{\partial t} - D\kappa + 1 = 0\]
                    \[\frac{\partial C}{\partial t} + D\kappa\theta + \frac{1}{2}D^2\sigma^2 = 0\]
                </li>
                <li>
                    <p>Solve the first ODE for D(t,T) with the boundary condition D(T,T) = 0:</p>
                    \[D(t,T) = B(t,T) = \frac{1 - e^{-\kappa(T-t)}}{\kappa}\]
                </li>
                <li>
                    <p>Substitute this into the second ODE and solve for C(t,T) with C(T,T) = 0:</p>
                    \[C(t,T) = (\theta - \frac{\sigma^2}{2\kappa^2})(B(t,T) - (T-t)) - \frac{\sigma^2}{4\kappa}B(t,T)^2\]
                </li>
                <li>
                    <p>Finally, we can express A(t,T) as:</p>
                    \[A(t,T) = e^{C(t,T)} = \exp\left((\theta - \frac{\sigma^2}{2\kappa^2})(B(t,T) - (T-t)) - \frac{\sigma^2}{4\kappa}B(t,T)^2\right)\]
                </li>
            </ol>
        </div>

        With these derivations, we now have closed-form expressions for A(t,T) and B(t,T) in the Vasicek model:
        </p>
        <p>
            \[B(t,T) = \frac{1 - e^{-\kappa(T-t)}}{\kappa}\]
        </p>
        <p>
            \[A(t,T) = \exp\left((\theta - \frac{\sigma^2}{2\kappa^2})(B(t,T) - (T-t)) - \frac{\sigma^2}{4\kappa}B(t,T)^2\right)\]
        </p>
        <p>
            These functions allow us to price zero-coupon bonds efficiently in the Vasicek model framework.
        </p>

        <div class="hint">
            <h4>Hint</h4>
            <p>
                The derivation of A(t,T) and B(t,T) relies on solving ordinary differential equations (ODEs). If you're not familiar with ODEs, it might be helpful to review some basic ODE solving techniques before tackling this derivation.
            </p>
        </div>

        <div class="quiz">
            <h3>Quick Quiz</h3>
            <ol>
                <li>How does the bond price in the Vasicek model depend on the current short rate \(r_t\)?</li>
                <li>What is the economic interpretation of the function B(t,T) in the Vasicek model?</li>
                <li>How do the model parameters \(\kappa\), \(\theta\), and \(\sigma\) affect the bond price through A(t,T) and B(t,T)?</li>
            </ol>
        </div>
        <div class="implementation-guide">
            <h3>Implementation Guide: Vasicek Bond Pricing</h3>
            <ol>
                <li>Define functions for \(A(t,T)\) and \(B(t,T)\)</li>
                <li>Implement the bond pricing formula</li>
                <li>Calculate yields from prices using the relationship: \(y = -\log(P) / (T-t)\)</li>
            </ol>
        </div>

        <div class="quiz">
            <h3>Quick Quiz</h3>
            <ol>
                <li>What happens to the short rate in the Vasicek model when it's above the long-term mean?</li>
                <li>Can the Vasicek model produce negative interest rates? Why or why not?</li>
            </ol>
        </div>
    </div>

    <div id="cir-model" class="chapter">
        <h2>Cox-Ingersoll-Ross (CIR) Model</h2>
        <p>
            The Cox-Ingersoll-Ross (CIR) model, introduced in 1985, addresses some limitations of the Vasicek model, particularly the possibility of negative interest rates.
        </p>

        <div class="key-concept">
            <h3>Key Concept: Square Root Diffusion</h3>
            <p>
                The CIR model uses a square root diffusion process, which ensures that interest rates remain non-negative (under certain parameter constraints) and that the volatility of interest rate changes increases with the level of interest rates.
            </p>
        </div>

        <h3>Model Specification</h3>
        <p>
            The CIR model is defined by the following stochastic differential equation:
        </p>
        <p>
            \[dr_t = \kappa(\theta - r_t)dt + \sigma\sqrt{r_t}dW_t\]
        </p>
        <p>
            The parameters have the same interpretation as in the Vasicek model, but the volatility term now includes \(\sqrt{r_t}\).
        </p>
        <h3>Bond Pricing in the CIR Model</h3>
        <p>
            Like the Vasicek model, the CIR model allows for closed-form solutions for bond prices. The price of a zero-coupon bond in the CIR model is given by:
        </p>
        <p>
            \[P(t,T) = A(t,T)e^{-B(t,T)r_t}\]
        </p>
        <p>
            where \(A(t,T)\) and \(B(t,T)\) are functions of the model parameters. Let's derive these functions step by step.
        </p>
        
        <div class="key-concept">
            <h4>Derivation of A(t,T) and B(t,T) for the CIR Model</h4>
            <ol>
                <li>
                    <p>We start with the assumption that the bond price has the form:</p>
                    \[P(t,T) = e^{C(t,T) - D(t,T)r_t}\]
                    <p>where we need to determine C(t,T) and D(t,T).</p>
                </li>
                <li>
                    <p>Apply Itô's lemma to this bond price formula, using the CIR SDE:</p>
                    \[\frac{dP(t,T)}{P(t,T)} = \left(\frac{\partial C}{\partial t} - \frac{\partial D}{\partial t}r_t - D\kappa(\theta - r_t) + \frac{1}{2}D^2\sigma^2r_t\right)dt - D\sigma\sqrt{r_t}dW_t\]
                </li>
                <li>
                    <p>Under the risk-neutral measure, the drift of the bond price should equal the short rate \(r_t\):</p>
                    \[r_t = \frac{\partial C}{\partial t} - \frac{\partial D}{\partial t}r_t - D\kappa(\theta - r_t) + \frac{1}{2}D^2\sigma^2r_t\]
                </li>
                <li>
                    <p>Equating the coefficients of \(r_t\) and the constant terms:</p>
                    \[\frac{\partial D}{\partial t} - D\kappa + 1 - \frac{1}{2}D^2\sigma^2 = 0\]
                    \[\frac{\partial C}{\partial t} + D\kappa\theta = 0\]
                </li>
                <li>
                    <p>Solve the first ODE for D(t,T) with the boundary condition D(T,T) = 0:</p>
                    \[D(t,T) = B(t,T) = \frac{2(e^{\gamma(T-t)} - 1)}{(\gamma + \kappa)(e^{\gamma(T-t)} - 1) + 2\gamma}\]
                    <p>where \(\gamma = \sqrt{\kappa^2 + 2\sigma^2}\)</p>
                </li>
                <li>
                    <p>Substitute this into the second ODE and solve for C(t,T) with C(T,T) = 0:</p>
                    \[C(t,T) = \frac{2\kappa\theta}{\sigma^2} \ln\left(\frac{2\gamma e^{(\gamma+\kappa)(T-t)/2}}{(\gamma + \kappa)(e^{\gamma(T-t)} - 1) + 2\gamma}\right)\]
                </li>
                <li>
                    <p>Finally, we can express A(t,T) as:</p>
                    \[A(t,T) = e^{C(t,T)} = \left(\frac{2\gamma e^{(\gamma+\kappa)(T-t)/2}}{(\gamma + \kappa)(e^{\gamma(T-t)} - 1) + 2\gamma}\right)^{\frac{2\kappa\theta}{\sigma^2}}\]
                </li>
            </ol>
        </div>
        
        <p>
            With these derivations, we now have closed-form expressions for A(t,T) and B(t,T) in the CIR model:
        </p>
        <p>
            \[B(t,T) = \frac{2(e^{\gamma(T-t)} - 1)}{(\gamma + \kappa)(e^{\gamma(T-t)} - 1) + 2\gamma}\]
        </p>
        <p>
            \[A(t,T) = \left(\frac{2\gamma e^{(\gamma+\kappa)(T-t)/2}}{(\gamma + \kappa)(e^{\gamma(T-t)} - 1) + 2\gamma}\right)^{\frac{2\kappa\theta}{\sigma^2}}\]
        </p>
        <p>
            where \(\gamma = \sqrt{\kappa^2 + 2\sigma^2}\).
        </p>
        
        <div class="hint">
            <h4>Hint</h4>
            <p>
                The CIR model ensures non-negative interest rates due to the square root term in the volatility. This property is reflected in the more complex forms of A(t,T) and B(t,T) compared to the Vasicek model.
            </p>
        </div>
        
        <div class="quiz">
            <h3>Quick Quiz</h3>
            <ol>
                <li>How does the bond price formula in the CIR model differ from that in the Vasicek model?</li>
                <li>What is the significance of the parameter \(\gamma\) in the CIR model bond pricing formula?</li>
                <li>How does the CIR model ensure non-negative interest rates, and how is this reflected in the bond pricing formula?</li>
            </ol>
        </div>
        <div class="implementation-guide">
            <h3>Implementation Guide: Simulating the CIR Model</h3>
            <ol>
                <li>Import necessary libraries</li>
                <li>Define model parameters: \(r_0\), \(\kappa\), \(\theta\), \(\sigma\)</li>
                <li>Set up time grid</li>
                <li>Initialize array for interest rates</li>
                <li>Implement simulation using a discretization scheme:
                    <pre><code class="language-python">
for i in range(1, len(t)):
    delta_r = kappa * (theta - r[i-1]) * delta_t + sigma * sqrt(r[i-1]) * sqrt(delta_t) * random.normal()
    r[i] = max(r[i-1] + delta_r, 0)  # Ensure non-negativity
                    </code></pre>
                </li>
            </ol>
        </div>
        <div id="hull-white-model" class="chapter">
            <h2>Hull-White Model</h2>
            <p>
                The Hull-White model, introduced by John Hull and Alan White in 1990, is an extension of the Vasicek model that allows for time-dependent parameters. This feature makes it particularly useful for fitting the initial term structure of interest rates.
            </p>
    
            <div class="key-concept">
                <h3>Key Concept: Time-Dependent Parameters</h3>
                <p>
                    The Hull-White model introduces time-dependent parameters to better fit observed market data, particularly the current term structure of interest rates. This allows the model to be more flexible and accurate in pricing interest rate derivatives.
                </p>
            </div>
    
            <h3>Model Specification</h3>
            <p>
                The Hull-White model is defined by the following stochastic differential equation:
            </p>
            <p>
                \[dr_t = [\theta(t) - \alpha(t)r_t]dt + \sigma(t) dW_t\]
            </p>
            <p>
                where:
            </p>
            <ul>
                <li>\(r_t\): short-term interest rate at time \(t\)</li>
                <li>\(\theta(t)\): time-dependent drift term</li>
                <li>\(\alpha(t)\): time-dependent mean reversion speed</li>
                <li>\(\sigma(t)\): time-dependent volatility</li>
                <li>\(W_t\): Wiener process (standard Brownian motion)</li>
            </ul>
    
            <div class="implementation-guide">
                <h3>Implementation Guide: Simulating the Hull-White Model</h3>
                <ol>
                    <li>Define time-dependent functions for \(\theta(t)\), \(\alpha(t)\), and \(\sigma(t)\)</li>
                    <li>Set up time grid: \(t = [0, \Delta t, 2\Delta t, ..., T]\)</li>
                    <li>Initialize array for interest rates: \(r = [r_0, 0, 0, ..., 0]\)</li>
                    <li>Implement Euler-Maruyama method for simulation:
                        <pre><code class="language-python">
    import numpy as np
    
    def hull_white_simulation(r0, T, N, theta, alpha, sigma):
        dt = T / N
        t = np.linspace(0, T, N+1)
        r = np.zeros(N+1)
        r[0] = r0
        
        for i in range(1, N+1):
            dr = (theta(t[i]) - alpha(t[i]) * r[i-1]) * dt + sigma(t[i]) * np.sqrt(dt) * np.random.normal()
            r[i] = r[i-1] + dr
        
        return t, r
                        </code></pre>
                    </li>
                </ol>
            </div>
    
            <div class="hint">
                <h4>Hint</h4>
                <p>
                    The Hull-White model can be calibrated to match the initial term structure by appropriately choosing the \(\theta(t)\) function. This process is often referred to as "fitting the initial term structure."
                </p>
            </div>
    
            <h3>Bond Pricing in the Hull-White Model</h3>
            <p>
                The Hull-White model extends the Vasicek model by introducing time-dependent parameters. This allows for a better fit to the initial term structure. The price of a zero-coupon bond in the Hull-White model is given by:
            </p>
            <p>
                \[P(t,T) = A(t,T)e^{-B(t,T)r_t}\]
            </p>
            <p>
                where \(A(t,T)\) and \(B(t,T)\) are functions that depend on the model parameters. Let's derive these functions step by step.
            </p>

            <div class="key-concept">
                <h4>Derivation of Bond Pricing Formula for the Hull-White Model</h4>
                <ol>
                    <li>
                        <p>Recall the Hull-White SDE:</p>
                        \[dr_t = [\theta(t) - \alpha(t)r_t]dt + \sigma(t) dW_t\]
                        <p>where \(\theta(t)\), \(\alpha(t)\), and \(\sigma(t)\) are time-dependent functions.</p>
                    </li>
                    <li>
                        <p>We start with the assumption that the bond price has the form:</p>
                        \[P(t,T) = e^{A(t,T) - B(t,T)r_t}\]
                    </li>
                    <li>
                        <p>Apply Itô's lemma to this bond price formula:</p>
                        \[\frac{dP(t,T)}{P(t,T)} = \left(\frac{\partial A}{\partial t} - \frac{\partial B}{\partial t}r_t + B[\theta(t) - \alpha(t)r_t] + \frac{1}{2}B^2\sigma(t)^2\right)dt - B\sigma(t)dW_t\]
                    </li>
                    <li>
                        <p>Under the risk-neutral measure, the drift of the bond price should equal the short rate \(r_t\):</p>
                        \[r_t = \frac{\partial A}{\partial t} - \frac{\partial B}{\partial t}r_t + B[\theta(t) - \alpha(t)r_t] + \frac{1}{2}B^2\sigma(t)^2\]
                    </li>
                    <li>
                        <p>Equating the coefficients of \(r_t\) and the constant terms:</p>
                        \[\frac{\partial B}{\partial t} + \alpha(t)B - 1 = 0\]
                        \[\frac{\partial A}{\partial t} + B\theta(t) - \frac{1}{2}B^2\sigma(t)^2 = 0\]
                    </li>
                    <li>
                        <p>Solve the first ODE for B(t,T) with the boundary condition B(T,T) = 0:</p>
                        \[B(t,T) = \int_t^T e^{-\int_t^s \alpha(u)du}ds\]
                    </li>
                    <li>
                        <p>Substitute this into the second ODE and solve for A(t,T) with A(T,T) = 0:</p>
                        \[A(t,T) = \int_t^T \left[B(s,T)\theta(s) - \frac{1}{2}B(s,T)^2\sigma(s)^2\right]ds\]
                    </li>
                    <li>
                        <p>The function \(\theta(t)\) can be chosen to fit the initial term structure. Let \(f^M(0,t)\) be the initial forward rate curve. Then:</p>
                        \[\theta(t) = \frac{\partial f^M(0,t)}{\partial t} + \alpha(t)f^M(0,t) + \frac{\sigma(t)^2}{2\alpha(t)}(1 - e^{-2\alpha(t)t})\]
                    </li>
                </ol>
            </div>

            <p>
                With these derivations, we now have expressions for A(t,T) and B(t,T) in the Hull-White model:
            </p>
            <p>
                \[B(t,T) = \int_t^T e^{-\int_t^s \alpha(u)du}ds\]
            </p>
            <p>
                \[A(t,T) = \int_t^T \left[B(s,T)\theta(s) - \frac{1}{2}B(s,T)^2\sigma(s)^2\right]ds\]
            </p>
            <p>
                where \(\theta(t)\) is chosen to fit the initial term structure.
            </p>

            <div class="hint">
                <h4>Hint</h4>
                <p>
                    The Hull-White model's time-dependent parameters allow for a perfect fit to the initial term structure. This makes it particularly useful for pricing interest rate derivatives, as it can accurately represent the current market conditions.
                </p>
            </div>

            <div class="quiz">
                <h3>Quick Quiz</h3>
                <ol>
                    <li>How does the Hull-White model differ from the Vasicek model in terms of its parameters?</li>
                    <li>Why is the Hull-White model particularly useful for fitting the initial term structure?</li>
                    <li>How does the choice of \(\theta(t)\) in the Hull-White model relate to the initial forward rate curve?</li>
                </ol>
            </div>
    
            <div class="implementation-guide">
                <h3>Implementation Guide: Hull-White Bond Pricing</h3>
                <ol>
                    <li>Implement functions for \(A(t,T)\) and \(B(t,T)\)</li>
                    <li>Calculate the bond price using the formula above</li>
                    <li>Derive yields from prices using \(y = -\log(P) / (T-t)\)</li>
                </ol>
            </div>
    
            <div class="quiz">
                <h3>Quick Quiz</h3>
                <ol>
                    <li>How does the Hull-White model differ from the Vasicek model?</li>
                    <li>Why is the Hull-White model particularly useful for pricing interest rate derivatives?</li>
                    <li>What is the significance of the time-dependent parameters in the Hull-White model?</li>
                </ol>
            </div>
        </div>
    
        <div id="g2-model" class="chapter">
            <h2>G2++ Model</h2>
            <p>
                The G2++ model, also known as the two-additive-factor Gaussian model, is a two-factor extension of the Hull-White model. It was introduced by Brigo and Mercurio to provide more flexibility in modeling the term structure of interest rates and volatilities.
            </p>
    
            <div class="key-concept">
                <h3>Key Concept: Multi-Factor Models</h3>
                <p>
                    Multi-factor models, like G2++, allow for a richer description of interest rate dynamics by incorporating multiple sources of randomness. This can lead to more realistic yield curve shapes and volatility structures, capturing complex market behaviors that single-factor models might miss.
                </p>
            </div>
    
            <h3>Model Specification</h3>
            <p>
                The G2++ model is defined by the following system of stochastic differential equations:
            </p>
            <p>
                \[dx_t = -ax_t dt + \sigma dW_t^1\]
                \[dy_t = -by_t dt + \eta dW_t^2\]
                \[r_t = x_t + y_t + \phi(t)\]
            </p>
            <p>
                where:
            </p>
            <ul>
                <li>\(x_t, y_t\): state variables</li>
                <li>\(a, b\): mean reversion speeds for \(x_t\) and \(y_t\) respectively</li>
                <li>\(\sigma, \eta\): volatilities for \(x_t\) and \(y_t\) respectively</li>
                <li>\(W_t^1, W_t^2\): correlated Wiener processes with correlation \(\rho\)</li>
                <li>\(\phi(t)\): deterministic function to fit the initial term structure</li>
            </ul>
    
            <div class="implementation-guide">
                <h3>Implementation Guide: Simulating the G2++ Model</h3>
                <ol>
                    <li>Define model parameters: \(a, b, \sigma, \eta, \rho\)</li>
                    <li>Define the \(\phi(t)\) function to fit the initial term structure</li>
                    <li>Set up time grid: \(t = [0, \Delta t, 2\Delta t, ..., T]\)</li>
                    <li>Initialize arrays for \(x_t\), \(y_t\), and \(r_t\)</li>
                    <li>Implement Euler-Maruyama method for simulation:
                        <pre><code class="language-python">
    import numpy as np
    
    def g2pp_simulation(x0, y0, T, N, a, b, sigma, eta, rho, phi):
        dt = T / N
        t = np.linspace(0, T, N+1)
        x = np.zeros(N+1)
        y = np.zeros(N+1)
        r = np.zeros(N+1)
        x[0], y[0] = x0, y0
        r[0] = x0 + y0 + phi(0)
        
        for i in range(1, N+1):
            dW1 = np.sqrt(dt) * np.random.normal()
            dW2 = rho * dW1 + np.sqrt(1 - rho**2) * np.sqrt(dt) * np.random.normal()
            x[i] = x[i-1] - a * x[i-1] * dt + sigma * dW1
            y[i] = y[i-1] - b * y[i-1] * dt + eta * dW2
            r[i] = x[i] + y[i] + phi(t[i])
        
        return t, r, x, y
                        </code></pre>
                    </li>
                </ol>
            </div>
    
            <div class="hint">
                <h4>Hint</h4>
                <p>
                    The correlation between the two factors in the G2++ model allows for a more flexible modeling of the yield curve, particularly in capturing the correlation between short-term and long-term rates. This can be crucial for accurately pricing certain types of interest rate derivatives.
                </p>
            </div>
    
            <h3>Bond Pricing in the G2++ Model</h3>
            <p>
                The G2++ model, also known as the two-additive-factor Gaussian model, is a two-factor extension of the Hull-White model. It provides more flexibility in modeling the term structure of interest rates. The price of a zero-coupon bond in the G2++ model is given by:
            </p>
            <p>
                \[P(t,T) = A(t,T)e^{-B_1(t,T)x_t - B_2(t,T)y_t}\]
            </p>
            <p>
                where \(A(t,T)\), \(B_1(t,T)\), and \(B_2(t,T)\) are functions that depend on the model parameters. Let's derive these functions step by step.
            </p>

            <div class="key-concept">
                <h4>Derivation of Bond Pricing Formula for the G2++ Model</h4>
                <ol>
                    <li>
                        <p>Recall the G2++ model SDEs:</p>
                        \[dx_t = -ax_t dt + \sigma dW_t^1\]
                        \[dy_t = -by_t dt + \eta dW_t^2\]
                        \[r_t = x_t + y_t + \phi(t)\]
                        <p>where \(W_t^1\) and \(W_t^2\) are Wiener processes with correlation \(\rho\), and \(\phi(t)\) is a deterministic function used to fit the initial term structure.</p>
                    </li>
                    <li>
                        <p>We start with the assumption that the bond price has the form:</p>
                        \[P(t,T) = e^{A(t,T) - B_1(t,T)x_t - B_2(t,T)y_t}\]
                    </li>
                    <li>
                        <p>Apply Itô's lemma to this bond price formula:</p>
                        \[\begin{align*}
                        \frac{dP(t,T)}{P(t,T)} = &\left(\frac{\partial A}{\partial t} - \frac{\partial B_1}{\partial t}x_t - \frac{\partial B_2}{\partial t}y_t + aB_1x_t + bB_2y_t \right. \\
                        &\left. + \frac{1}{2}B_1^2\sigma^2 + \frac{1}{2}B_2^2\eta^2 + B_1B_2\sigma\eta\rho\right)dt \\
                        &- B_1\sigma dW_t^1 - B_2\eta dW_t^2
                        \end{align*}\]
                    </li>
                    <li>
                        <p>Under the risk-neutral measure, the drift of the bond price should equal the short rate \(r_t = x_t + y_t + \phi(t)\):</p>
                        \[\begin{align*}
                        x_t + y_t + \phi(t) = &\frac{\partial A}{\partial t} - \frac{\partial B_1}{\partial t}x_t - \frac{\partial B_2}{\partial t}y_t + aB_1x_t + bB_2y_t \\
                        &+ \frac{1}{2}B_1^2\sigma^2 + \frac{1}{2}B_2^2\eta^2 + B_1B_2\sigma\eta\rho
                        \end{align*}\]
                    </li>
                    <li>
                        <p>Equating the coefficients of \(x_t\), \(y_t\), and the constant terms:</p>
                        \[\frac{\partial B_1}{\partial t} = aB_1 - 1\]
                        \[\frac{\partial B_2}{\partial t} = bB_2 - 1\]
                        \[\frac{\partial A}{\partial t} = -\phi(t) - \frac{1}{2}B_1^2\sigma^2 - \frac{1}{2}B_2^2\eta^2 - B_1B_2\sigma\eta\rho\]
                    </li>
                    <li>
                        <p>Solve the ODEs for \(B_1(t,T)\) and \(B_2(t,T)\) with boundary conditions \(B_1(T,T) = B_2(T,T) = 0\):</p>
                        \[B_1(t,T) = \frac{1 - e^{-a(T-t)}}{a}\]
                        \[B_2(t,T) = \frac{1 - e^{-b(T-t)}}{b}\]
                    </li>
                    <li>
                        <p>Substitute these into the ODE for \(A(t,T)\) and solve with \(A(T,T) = 0\):</p>
                        \[\begin{align*}
                        A(t,T) = &-\int_t^T \phi(s)ds + \frac{\sigma^2}{2a^2}\left(B_1(t,T) - (T-t) - \frac{2}{a}(e^{-a(T-t)} - 1)\right) \\
                        &+ \frac{\eta^2}{2b^2}\left(B_2(t,T) - (T-t) - \frac{2}{b}(e^{-b(T-t)} - 1)\right) \\
                        &+ \frac{\sigma\eta\rho}{ab}\left(B_1(t,T) + B_2(t,T) - (T-t) - \frac{1}{a}(e^{-a(T-t)} - 1) - \frac{1}{b}(e^{-b(T-t)} - 1)\right)
                        \end{align*}\]
                    </li>
                    <li>
                        <p>The function \(\phi(t)\) is chosen to fit the initial term structure:</p>
                        \[\phi(t) = f^M(0,t) + \frac{\sigma^2}{2a^2}(1 - e^{-at})^2 + \frac{\eta^2}{2b^2}(1 - e^{-bt})^2 + \frac{\sigma\eta\rho}{ab}(1 - e^{-at})(1 - e^{-bt})\]
                        <p>where \(f^M(0,t)\) is the initial instantaneous forward rate curve.</p>
                    </li>
                </ol>
            </div>

            <p>
                With these derivations, we now have expressions for \(A(t,T)\), \(B_1(t,T)\), and \(B_2(t,T)\) in the G2++ model:
            </p>
            <p>
                \[B_1(t,T) = \frac{1 - e^{-a(T-t)}}{a}\]
            </p>
            <p>
                \[B_2(t,T) = \frac{1 - e^{-b(T-t)}}{b}\]
            </p>
            <p>
                \[A(t,T) = \text{[as derived in step 7 above]}\]
            </p>

            <div class="hint">
                <h4>Hint</h4>
                <p>
                    The G2++ model's two-factor structure allows for a more flexible representation of the yield curve and its dynamics. This can be particularly useful for pricing complex interest rate derivatives or for risk management purposes where capturing the correlation between different parts of the yield curve is important.
                </p>
            </div>

            <div class="quiz">
                <h3>Quick Quiz</h3>
                <ol>
                    <li>How does the G2++ model differ from single-factor models like Vasicek or Hull-White?</li>
                    <li>What is the significance of the correlation parameter \(\rho\) in the G2++ model?</li>
                    <li>How does the G2++ model achieve a perfect fit to the initial term structure?</li>
                </ol>
            </div>
    
            <div class="implementation-guide">
                <h3>Implementation Guide: G2++ Bond Pricing</h3>
                <ol>
                    <li>Implement functions for \(A(t,T)\), \(B_1(t,T)\), and \(B_2(t,T)\)</li>
                    <li>Calculate the bond price using the formula above</li>
                    <li>Derive yields from prices using \(y = -\log(P) / (T-t)\)</li>
                </ol>
            </div>
    
            <div class="quiz">
                <h3>Quick Quiz</h3>
                <ol>
                    <li>How does the G2++ model improve upon single-factor models like Vasicek or Hull-White?</li>
                    <li>What is the significance of the correlation parameter \(\rho\) in the G2++ model?</li>
                    <li>Can you think of a financial scenario where using a two-factor model like G2++ would be particularly beneficial compared to a single-factor model?</li>
                </ol>
            </div>
        </div>

        <div id="dynamic-affine-models" class="chapter">
            <h2>Dynamic Affine Term Structure Models</h2>
            <p>
                Dynamic Affine Term Structure Models (DATSMs) provide a flexible and powerful framework for modeling interest rates. These models generalize many of the specific models we've discussed earlier, including Vasicek, CIR, and multi-factor models.
            </p>
        
            <div class="key-concept">
                <h3>Key Concept: Affine Term Structure</h3>
                <p>
                    In an affine term structure model, bond yields are affine (linear plus a constant) functions of the state variables. This property leads to tractable solutions for bond prices and yields.
                </p>
            </div>
        
            <h3>General Framework</h3>
            <p>
                A general N-factor affine term structure model can be described by the following system:
            </p>
            <p>
                \[dX_t = K(\theta - X_t)dt + \Sigma\sqrt{S_t}dW_t\]
            </p>
            <p>
                \[r_t = \delta_0 + \delta_1' X_t\]
            </p>
            <p>
                where:
            </p>
            <ul>
                <li>\(X_t\) is an N-dimensional vector of state variables</li>
                <li>\(K\) is an N × N matrix representing mean reversion speeds</li>
                <li>\(\theta\) is an N-dimensional vector of long-term means</li>
                <li>\(\Sigma\) is an N × N volatility matrix</li>
                <li>\(S_t\) is a diagonal matrix with elements \([S_t]_{ii} = \alpha_i + \beta_i' X_t\)</li>
                <li>\(W_t\) is an N-dimensional standard Brownian motion</li>
                <li>\(r_t\) is the instantaneous short rate</li>
                <li>\(\delta_0\) is a scalar and \(\delta_1\) is an N-dimensional vector</li>
            </ul>
        
            <h3>Bond Pricing</h3>
            <p>
                In this framework, the price of a zero-coupon bond has the form:
            </p>
            <p>
                \[P(t,T) = \exp(A(t,T) + B(t,T)'X_t)\]
            </p>
            <p>
                where \(A(t,T)\) is a scalar and \(B(t,T)\) is an N-dimensional vector satisfying a system of ordinary differential equations (ODEs):
            </p>
            <p>
                \[\frac{\partial B(t,T)}{\partial t} = -\delta_1 + K'B(t,T) - \frac{1}{2}\sum_{i=1}^N (\Sigma'B(t,T))_i^2\beta_i\]
            </p>
            <p>
                \[\frac{\partial A(t,T)}{\partial t} = -\delta_0 + B(t,T)'\theta - \frac{1}{2}\sum_{i=1}^N (\Sigma'B(t,T))_i^2\alpha_i\]
            </p>
            <p>
                with boundary conditions \(A(T,T) = 0\) and \(B(T,T) = 0\).
            </p>
        
            <div class="implementation-guide">
                <h3>Derivation Guide: A and B Functions for Dynamic Affine Term Structure Models</h3>
                <p>
                    Let's derive the ordinary differential equations (ODEs) for the A and B functions in a dynamic affine term structure model. We'll use the general N-factor model framework.
                </p>
                <ol>
                    <li>
                        <p>Recall the general form of the N-factor model:</p>
                        \[dX_t = K(\theta - X_t)dt + \Sigma\sqrt{S_t}dW_t\]
                        \[r_t = \delta_0 + \delta_1' X_t\]
                        <p>where \(S_t\) is a diagonal matrix with elements \([S_t]_{ii} = \alpha_i + \beta_i' X_t\).</p>
                    </li>
                    <li>
                        <p>Assume the bond price has the form:</p>
                        \[P(t,T) = \exp(A(t,T) + B(t,T)'X_t)\]
                    </li>
                    <li>
                        <p>Apply Itô's lemma to the bond price:</p>
                        \[\begin{align*}
                        \frac{dP(t,T)}{P(t,T)} = &\left(\frac{\partial A}{\partial t} + \frac{\partial B'}{\partial t}X_t + B'K(\theta - X_t) \right. \\
                        &\left. + \frac{1}{2}\sum_{i=1}^N (B'\Sigma)_i^2(\alpha_i + \beta_i'X_t)\right)dt \\
                        &+ B'\Sigma\sqrt{S_t}dW_t
                        \end{align*}\]
                    </li>
                    <li>
                        <p>Under the risk-neutral measure, the drift of the bond price should equal the short rate:</p>
                        \[\begin{align*}
                        \delta_0 + \delta_1'X_t = &\frac{\partial A}{\partial t} + \frac{\partial B'}{\partial t}X_t + B'K(\theta - X_t) \\
                        &+ \frac{1}{2}\sum_{i=1}^N (B'\Sigma)_i^2(\alpha_i + \beta_i'X_t)
                        \end{align*}\]
                    </li>
                    <li>
                        <p>Equate the coefficients of \(X_t\) and the constant terms:</p>
                        \[\delta_1' = \frac{\partial B'}{\partial t} - B'K + \frac{1}{2}\sum_{i=1}^N (B'\Sigma)_i^2\beta_i'\]
                        \[\delta_0 = \frac{\partial A}{\partial t} + B'K\theta + \frac{1}{2}\sum_{i=1}^N (B'\Sigma)_i^2\alpha_i\]
                    </li>
                    <li>
                        <p>Transpose the first equation and rearrange to get the ODE for B(t,T):</p>
                        \[\frac{\partial B(t,T)}{\partial t} = -\delta_1 + K'B(t,T) - \frac{1}{2}\sum_{i=1}^N (\Sigma'B(t,T))_i^2\beta_i\]
                    </li>
                    <li>
                        <p>Rearrange the second equation to get the ODE for A(t,T):</p>
                        \[\frac{\partial A(t,T)}{\partial t} = -\delta_0 + B(t,T)'\theta - \frac{1}{2}\sum_{i=1}^N (\Sigma'B(t,T))_i^2\alpha_i\]
                    </li>
                    <li>
                        <p>The boundary conditions come from P(T,T) = 1, which implies:</p>
                        \[A(T,T) = 0 \quad \text{and} \quad B(T,T) = 0\]
                    </li>
                </ol>
            </div>
            
            <div class="key-concept">
                <h3>Key Insights from the Derivation</h3>
                <ul>
                    <li>The ODEs for A(t,T) and B(t,T) are coupled: solving for B(t,T) is necessary to solve for A(t,T).</li>
                    <li>The complexity of these ODEs depends on the specific form of \(S_t\), which determines how the volatility of the state variables depends on their levels.</li>
                    <li>For many models (e.g., Vasicek, CIR), these ODEs have closed-form solutions. For more complex models, numerical methods may be necessary.</li>
                    <li>The risk-neutral dynamics of the state variables directly influence the form of these ODEs, highlighting the connection between the underlying economic assumptions and the resulting term structure.</li>
                </ul>
            </div>
            
            <div class="hint">
                <h4>Hint</h4>
                <p>
                    When implementing these models, it's often useful to solve the ODE for B(t,T) first, as its solution is needed for the ODE of A(t,T). For models without closed-form solutions, consider using numerical ODE solvers and solving the equations backwards in time from the known terminal conditions.
                </p>
            </div>
            
            <div class="quiz">
                <h3>Quick Quiz</h3>
                <ol>
                    <li>How does the form of \(S_t\) affect the complexity of the ODEs for A(t,T) and B(t,T)?</li>
                    <li>Why do we need to solve these ODEs backwards in time?</li>
                    <li>Can you identify which terms in the ODEs correspond to the drift and diffusion components of the state variable dynamics?</li>
                </ol>
            </div>
        
            <div class="hint">
                <h4>Hint</h4>
                <p>
                    The flexibility of DATSMs comes at the cost of increased complexity. While these models can capture a wide range of term structure behaviors, they often require sophisticated numerical methods for implementation and calibration.
                </p>
            </div>
        
            <h3>Advantages and Applications</h3>
            <p>
                Dynamic Affine Term Structure Models offer several advantages:
            </p>
            <ul>
                <li>Flexibility to capture complex yield curve dynamics</li>
                <li>Ability to incorporate both Gaussian and square-root diffusion processes</li>
                <li>Tractable solutions for bond prices and yields</li>
                <li>Capacity to model both nominal and real interest rates</li>
            </ul>
            <p>
                These models are widely used in:
            </p>
            <ul>
                <li>Pricing and hedging of interest rate derivatives</li>
                <li>Risk management of fixed-income portfolios</li>
                <li>Monetary policy analysis</li>
                <li>Macroeconomic modeling</li>
            </ul>
        
            <div class="quiz">
                <h3>Quick Quiz</h3>
                <ol>
                    <li>How do Dynamic Affine Term Structure Models generalize the specific models we've studied earlier?</li>
                    <li>What is the significance of the affine property in these models?</li>
                    <li>Can you think of a situation where a multi-factor DATSM would be preferable to a single-factor model?</li>
                </ol>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>    
    </body>
    </html>